{{ define "main" }}
<div class="container">
    <div class="row">
        <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <h1>搜索</h1>
            <div id="search-box">
                <input type="text" id="search-input" placeholder="输入关键词搜索..." class="form-control">
            </div>
            <div id="search-results" class="mt-4">
                <div id="search-stats"></div>
                <div id="search-hits"></div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    const searchResults = document.getElementById('search-hits');
    const searchStats = document.getElementById('search-stats');
    let searchIndex = null;

    // 加载搜索索引
    fetch('/search.json')
        .then(response => response.json())
        .then(data => {
            searchIndex = new Fuse(data, {
                keys: ['title', 'content'],
                threshold: 0.3,
                includeScore: true,
                includeMatches: true
            });
        });

    // 搜索功能
    searchInput.addEventListener('input', function(e) {
        const query = e.target.value;
        if (!query || !searchIndex) {
            searchResults.innerHTML = '';
            searchStats.innerHTML = '';
            return;
        }

        const results = searchIndex.search(query);
        displayResults(results);
    });

    // 显示搜索结果
    function displayResults(results) {
        if (results.length === 0) {
            searchResults.innerHTML = '<p>没有找到相关结果</p>';
            searchStats.innerHTML = '';
            return;
        }

        searchStats.innerHTML = `<p>找到 ${results.length} 个结果</p>`;
        
        const html = results.map(result => {
            const item = result.item;
            return `
                <div class="search-result-item">
                    <h3><a href="${item.permalink}">${item.title}</a></h3>
                    <p>${item.summary || ''}</p>
                    <div class="search-meta">
                        <span class="search-date">${new Date(item.date).toLocaleDateString()}</span>
                        ${item.categories ? `<span class="search-categories">分类: ${item.categories.join(', ')}</span>` : ''}
                    </div>
                </div>
            `;
        }).join('');

        searchResults.innerHTML = html;
    }
});
</script>

<style>
.search-result-item {
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #eee;
}

.search-result-item h3 {
    margin-bottom: 0.5rem;
}

.search-result-item p {
    color: #666;
    margin-bottom: 0.5rem;
}

.search-meta {
    font-size: 0.9rem;
    color: #888;
}

.search-meta span {
    margin-right: 1rem;
}

#search-box {
    margin: 2rem 0;
}

#search-input {
    padding: 0.5rem;
    font-size: 1.1rem;
    border: 2px solid #ddd;
    border-radius: 4px;
    width: 100%;
}

#search-input:focus {
    outline: none;
    border-color: #666;
}

#search-stats {
    margin-bottom: 1rem;
    color: #666;
}
</style>
{{ end }} 